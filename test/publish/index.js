!function(){function e(e){var t,n,o,r=e.exportElement,a=e.exportFileName,i=e.StringStyle,l=e.fileParams,c=$("#html-docx-config").html(),f=function(){var e=$("#page-header");$("#page-header").attr({data:e.html()}).html("");var t="";$("#first-page").length&&$("#page-content").length&&(t="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head></head><body>"+$($("#first-page")).html().replace(/\s{2,}/g,"")+"</body></html>",$("#first-page").html(""));var n=$("#page-content");$('<br clear=all style="page-break-before:always" mce_style="page-break-before:always">').insertAfter($(".change-line"));var o=$("#page-footer");return{header:{text:e.attr("data")||"",align:e.attr("textAlign")||"right"},footer:!!o.length,content:n.length,firstPage:t,titlePg:!(!$("#first-page").length||"true"!==$("#first-page").attr("titlePg"))}}(),d="#temporaryExportElement";$("<div id='temporaryExportElement'></div>").html($(r).html()).appendTo(document.body),function(e,t){for(var n=$(e).find("canvas"),o=$(t).find("canvas"),r=0;r<n.length;r++){var a=$(o[r]).parent().parent(),i=n[r].toDataURL("image/jpg");$(a).empty(),$("<img/>").attr({src:i,width:$(n[r]).width(),height:$(n[r]).height()}).appendTo(a)}}(r,d),t=document.querySelectorAll("img"),n=document.createElement("canvas"),o=n.getContext("2d"),[].forEach.call(t,function(e){(e=new Image).setAttribute("crossOrigin","anonymous"),o.clearRect(0,0,n.width,n.height),n.width=e.width,n.height=e.height,o.drawImage(e,0,0);var t=n.toDataURL();e.setAttribute("src",t)}),n.remove(),console.log($(d).html());var s="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head></head><style>"+(i?i.replace(/(\s{2,}|\n)/g,""):"")+"</style><body>"+$(d).html().replace(/\s{2,}/g,"")+"</body></html>",u=l||{},m=[s,f.firstPage];console.log(s);var h=htmlDocx.asBlob(m,{margins:u.margins,config:f});$("#temporaryExportElement").remove(),g(h,a),f.firstPage&&$("#html-docx-config").html(c)}var g=g||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(g){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var p=g.document,w=function(){return g.URL||g.webkitURL||g},v=p.createElementNS("http://www.w3.org/1999/xhtml","a"),y=!g.externalHost&&"download"in v,E=g.webkitRequestFileSystem,b=g.requestFileSystem||E||g.mozRequestFileSystem,a=function(e){(g.setImmediate||g.setTimeout)(function(){throw e},0)},$="application/octet-stream",x=0,R=[],e=function(){for(var e=R.length;e--;){var t=R[e];"string"==typeof t?w().revokeObjectURL(t):t.remove()}R.length=0},S=function(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){a(e)}}},n=function(o,n){function e(){var e=w().createObjectURL(o);return R.push(e),e}function t(){S(s,"writestart progress write writeend".split(" "))}function r(){!m&&i||(i=e()),l?l.location.href=i:window.open(i,"_blank"),s.readyState=s.DONE,t()}function a(e){return function(){if(s.readyState!==s.DONE)return e.apply(this,arguments)}}var i,l,c,f,d,s=this,u=o.type,m=!1,h={create:!0,exclusive:!1};if(s.readyState=s.INIT,n=n||"download",y)return i=e(),v.href=i,v.download=n,f=v,(d=p.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,g,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(d),s.readyState=s.DONE,void t();g.chrome&&u&&u!==$&&(c=o.slice||o.webkitSlice,o=c.call(o,0,o.size,$),m=!0),E&&"download"!==n&&(n+=".download"),u!==$&&!E||(l=g),b?(x+=o.size,b(g.TEMPORARY,x,a(function(e){e.root.getDirectory("saved",h,a(function(e){function t(){e.getFile(n,h,a(function(n){n.createWriter(a(function(t){t.onwriteend=function(e){l.location.href=n.toURL(),R.push(n),s.readyState=s.DONE,S(s,"writeend",e)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&r()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=s["on"+e]}),t.write(o),s.abort=function(){t.abort(),s.readyState=s.DONE},s.readyState=s.WRITING}),r)}),r)}e.getFile(n,{create:!1},a(function(e){e.remove(),t()}),a(function(e){(e.code===e.NOT_FOUND_ERR?t:r)()}))}),r)}),r)):r()},t=n.prototype,o=function(e,t){return new n(e,t)};return t.abort=function(){this.readyState=this.DONE,S(this,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,g.addEventListener("unload",e,!1),o.unload=function(){e(),g.removeEventListener("unload",e,!1)},o}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=g:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return g}),"undefined"!=typeof module&&null!==module?module.exports=e:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return e}):"undefined"!=typeof window&&(window.exportFile=e)}();